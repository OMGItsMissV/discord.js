{"version":3,"sources":["../../src/Client/InternalClient.js"],"names":["GATEWAY_VERSION","zlib","waitFor","condition","value","interval","Promise","resolve","int","setInterval","isDone","clearInterval","delay","ms","setTimeout","InternalClient","constructor","discordClient","setupCalled","setup","apiRequest","method","url","useAuth","data","file","reject","promise","res","rej","buckets","match","channels","get","private_channels","server","id","user","bot","username","self","actualCall","startTime","Date","now","ret","set","token","attach","name","i","hasOwnProperty","undefined","field","send","userAgentInfo","full","end","error","status","client","emit","options","shard","body","done","bucket","queue","sessionID","hasBeenReady","state","IDLE","websocket","userAgent","version","require","compress","users","friends","blocked_users","outgoing_friend_requests","incoming_friend_requests","servers","unavailableServers","autoReconnectInterval","unsyncedGuilds","guildSyncQueue","guildSyncQueueLength","intervals","typing","kai","misc","voiceConnections","resolver","readyTime","messageAwaits","tokenCacher","init","cleanIntervals","concat","disconnected","autoReconnect","forEach","vc","leaveVoiceChannel","Math","min","random","email","loginWithToken","password","catch","uptime","info","chann","leave","connection","destroy","resolveChannel","then","channel","Error","type","awaitResponse","msg","resolveMessage","awaitID","author","push","joinVoiceChannel","joinSendWS","sendWS","op","d","joinVoice","session","endpoint","timeout","check","t","guild_id","clearTimeout","removeListener","on","existingServerConn","length","voiceConnection","getGuildMembers","serverID","chunkCount","forceFetchCount","forceFetchLength","requestGuildMembers","forceFetchQueue","query","limit","syncGuild","guildID","checkReady","key","restartServerCreateTimeout","guildCreateTimeout","createServer","region","resolveString","SERVERS","joinServer","invite","resolveInviteID","INVITE","guild","updateServer","resolveServer","newOptions","icon","resolveToBase64","splash","owner","resolveUser","owner_id","verificationLevel","verification_level","afkChannel","afk_channel_id","afkTimeout","afk_timeout","SERVER","leaveServer","srv","ME_SERVER","deleteServer","console","log","LOGGED_IN","getGateway","startsWith","createWS","login","tk","getToken","DISCONNECTED","LOGGING_IN","LOGIN","setToken","logout","disconnect","close","LOGOUT","startPM","resUser","ME_CHANNELS","recipient_id","add","gatewayURL","GATEWAY","sendMessage","where","_content","String","basename","path","destination","content","disableEveryone","replace","resolveFile","CHANNEL_MESSAGES","tts","nonce","messages","sendFile","_file","deleteMessage","_message","message","chain","wait","CHANNEL_MESSAGE","remove","deleteMessages","_messages","Array","map","m","updateMessage","update","getChannelLogs","_channel","qsObject","before","after","around","stringify","getMessage","messageID","pinMessage","CHANNEL_PIN","unpinMessage","pinned","getPinnedMessages","CHANNEL_PINS","getBans","SERVER_BANS","ban","createChannel","SERVER_CHANNELS","deleteChannel","CHANNEL","banMember","resolvedUser","unbanMember","kickMember","SERVER_MEMBERS","moveMember","channel_id","voiceChannel","muteMember","mute","unmuteMember","deafenMember","deaf","undeafenMember","setNickname","nick","setNote","note","ME_NOTES","createRole","SERVER_ROLES","role","roles","updateRole","resolveRole","newData","color","hoist","position","permissions","mentionable","perm","deleteRole","addMemberToRole","member","isArray","r","some","memberMap","roleIDs","indexOf","memberHasRole","roledata","rolesOf","removeMemberFromRole","item","splice","createInvite","chanServ","validate","max_age","maxAge","max_uses","maxUses","temporary","xkcdpass","xkcd","CHANNEL_INVITES","deleteInvite","getInvite","has","res2","getInvites","SERVER_INVITES","overwritePermissions","updated","allow","deny","previousOverwrite","permissionOverwrites","CHANNEL_PERMISSIONS","setStatus","idleStatus","game","packet","idle_since","sendTyping","startTyping","stopTyping","updateDetails","avatar","new_password","newPassword","ME","setAvatar","setUsername","setChannelTopic","topic","updateChannel","setChannelName","setChannelPosition","setChannelUserLimit","userLimit","setChannelBitrate","kbitrate","bitrate","user_limit","ceil","_bitrate","addFriend","discriminator","FRIENDS","removeFriend","getServerWebhooks","SERVER_WEBHOOKS","webhook","webhooks","getChannelWebhooks","CHANNEL_WEBHOOKS","editWebhook","resolveWebhook","WEBHOOK","createWebhook","deleteWebhook","sendWebhookMessage","slack","WEBHOOK_MESSAGE","getOAuthApplication","appID","OAUTH2_APPLICATION","ack","object","JSON","endsWith","onopen","onclose","event","code","err","sequence","onerror","e","onmessage","Buffer","inflateSync","toString","parse","s","processPacket","heartbeatAcked","heartbeat","identify","resume","heartbeat_interval","RESUMED","READY","session_id","guilds","unavailable","forceFetchUsers","members","memberCount","pm","relationships","friend","notes","newUser","MESSAGE_CREATE","lastMessageID","fn","MESSAGE_DELETE","MESSAGE_DELETE_BULK","ids","MESSAGE_UPDATE","attachments","embeds","timestamp","mention_everyone","everyoneMentioned","mentions","nmsg","SERVER_CREATE","large","SERVER_DELETE","found","SERVER_UPDATE","newserver","equalsStrict","CHANNEL_CREATE","chan","is_private","CHANNEL_DELETE","CHANNEL_UPDATE","SERVER_ROLE_CREATE","SERVER_ROLE_DELETE","role_id","SERVER_ROLE_UPDATE","newRole","SERVER_MEMBER_ADD","selfMute","selfDeaf","joinedAt","joined_at","SERVER_MEMBER_REMOVE","SERVER_MEMBER_UPDATE","oldMember","self_mute","self_deaf","PRESENCE_UPDATE","presenceUser","USER_UPDATE","TYPING","user_id","since","SERVER_BAN_ADD","SERVER_BAN_REMOVE","USER_NOTE_UPDATE","oldNote","updatedUser","VOICE_STATE_UPDATE","eventVoiceStateUpdate","eventVoiceLeave","SERVER_MEMBERS_CHUNK","testtime","FRIEND_ADD","inUser","outUser","FRIEND_REMOVE","rejectedUser","incomingCancel","SERVER_SYNC","dataUser","internal","presence","presences","pendingVoiceStates","voiceState","eventVoiceJoin","seq","v","large_threshold","largeThreshold","properties","process","platform"],"mappings":"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","file":"InternalClient.js","sourcesContent":["\"use strict\";\n\nimport request from \"superagent\";\nimport WebSocket from \"ws\";\nimport ConnectionState from \"./ConnectionState\";\nimport qs from \"querystring\";\n\nimport {Endpoints, PacketType, Permissions} from \"../Constants\";\n\nimport Bucket from \"../Util/Bucket\";\nimport Cache from \"../Util/Cache\";\nimport Resolver from \"./Resolver/Resolver\";\n\nimport User from \"../Structures/User\";\nimport Channel from \"../Structures/Channel\";\nimport ServerChannel from \"../Structures/ServerChannel\";\nimport TextChannel from \"../Structures/TextChannel\";\nimport VoiceChannel from \"../Structures/VoiceChannel\";\nimport PMChannel from \"../Structures/PMChannel\";\nimport Server from \"../Structures/Server\";\nimport Message from \"../Structures/Message\";\nimport Role from \"../Structures/Role\";\nimport Invite from \"../Structures/Invite\";\nimport Webhook from \"../Structures/Webhook\";\nimport VoiceConnection from \"../Voice/VoiceConnection\";\nimport TokenCacher from \"../Util/TokenCacher\";\n\nlet GATEWAY_VERSION = 6;\nlet zlib;\n// let libVersion = require('../../package.json').version;\n\nfunction waitFor(condition, value = condition, interval = 20) {\n  return new Promise(resolve => {\n    let int = setInterval(() => {\n      let isDone = condition();\n      if (isDone) {\n        if (condition === value) {\n          resolve(isDone);\n        } else {\n          resolve(value(isDone));\n        }\n        return clearInterval(int);\n      }\n    }, interval);\n  });\n}\n\nfunction delay(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport default class InternalClient {\n\tconstructor(discordClient) {\n\t  this.setupCalled = false;\n\t\tthis.setup(discordClient);\n\t}\n\n  apiRequest(method, url, useAuth, data, file) {\n    let resolve, reject;\n    let promise = new Promise((res, rej) => {\n      resolve = res;\n      reject = rej;\n    });\n    let buckets = [];\n    let match = url.match(/\\/channels\\/([0-9]+)\\/messages(\\/[0-9]+)?$/);\n    if (match) {\n      if (method === \"del\" && (match[1] = this.channels.get(\"id\", match[1]) || this.private_channels.get(\"id\", match[1]))) {\n        buckets = [\"dmsg:\" + (match[1].server || {}).id];\n      } else if (this.user.bot) {\n        if (method === \"post\" || method === \"patch\") {\n          if (this.private_channels.get(\"id\", match[1])) {\n            buckets = [\"bot:msg:dm\", \"bot:msg:global\"];\n          } else if ((match[1] = this.channels.get(\"id\", match[1]))) {\n            buckets = [\"bot:msg:guild:\" + match[1].server.id, \"bot:msg:global\"];\n          }\n        }\n      } else {\n        buckets = [\"msg\"];\n      }\n    } else if (method === \"patch\") {\n      if (url === \"/users/@me\" && this.user && data.username && data.username !== this.user.username) {\n        buckets = [\"username\"];\n      } else if ((match = url.match(/\\/guilds\\/([0-9]+)\\/members\\/[0-9]+$/))) {\n        buckets = [\"guild_member:\" + match[1]];\n      } else if ((match = url.match(/\\/guilds\\/([0-9]+)\\/members\\/@me\\/nick$/))) {\n        buckets = [\"guild_member_nick:\" + match[1]];\n      }\n    }\n\n    let self = this;\n\n    let actualCall = function () {\n      let startTime = Date.now();\n      let ret = request[method](url);\n      if (useAuth) {\n        ret.set(\"authorization\", self.token);\n      }\n      if (file) {\n        ret.attach(\"file\", file.file, file.name);\n        if (data) {\n          for (let i in data) {\n            if (data.hasOwnProperty(i)) {\n              if (data[i] !== undefined) {\n                ret.field(i, data[i]);\n              }\n            }\n          }\n        }\n      } else if (data) {\n        ret.send(data);\n      }\n      ret.set('User-Agent', self.userAgentInfo.full);\n      ret.end((error, data) => {\n        if (error) {\n          if (data && data.status === 429) {\n            self.client.emit(\"debug\", \"Encountered 429 at \" + url + \" | \" + self.client.options.shard + \" | Buckets\" + buckets + \" | \" + (Date.now() - startTime) + \"ms latency\");\n          }\n          reject(error);\n        } else {\n          resolve(data.body);\n        }\n      });\n    };\n    let waitFor = 1;\n    let i = 0;\n    let done = function () {\n      if (++i === waitFor) {\n        actualCall();\n      }\n    };\n    for (let bucket of buckets) {\n      ++waitFor;\n      this.buckets[bucket].queue(done);\n    }\n    done();\n    return promise;\n  }\n\n  setup(discordClient) {\n\t  this.sessionID = false;\n\t  this.hasBeenReady = false;\n    this.setupCalled = true;\n    discordClient = discordClient || this.client;\n    this.client = discordClient;\n    this.state = ConnectionState.IDLE;\n    this.websocket = null;\n    this.userAgent = {\n      url: 'https://github.com/hydrabolt/discord.js',\n      version: require('../../package.json').version\n    };\n\n    if (this.client.options.compress) {\n      zlib = require(\"zlib\");\n    }\n\n    // creates 4 caches with discriminators based on ID\n    this.users = new Cache();\n    this.friends = new Cache();\n    this.blocked_users = new Cache();\n    this.outgoing_friend_requests = new Cache();\n    this.incoming_friend_requests = new Cache();\n    this.channels = new Cache();\n    this.servers = new Cache();\n    this.unavailableServers = new Cache();\n    this.private_channels = new Cache();\n    this.autoReconnectInterval = 1000;\n    this.unsyncedGuilds = 0;\n    this.guildSyncQueue = [];\n    this.guildSyncQueueLength = 1;\n\n    this.intervals = {\n      typing: [],\n      kai: null,\n      misc: []\n    };\n\n    this.voiceConnections = new Cache();\n    this.resolver = new Resolver(this);\n    this.readyTime = null;\n    this.messageAwaits = {};\n    this.buckets = {\n      \"bot:msg:dm\": new Bucket(5, 5000),\n      \"bot:msg:global\": new Bucket(50, 10000),\n      \"msg\": new Bucket(10, 10000),\n      \"dmsg:undefined\": new Bucket(5, 1000),\n      \"username\": new Bucket(2, 3600000)\n    };\n\n    if (!this.tokenCacher) {\n      this.tokenCacher = new TokenCacher(this.client);\n      this.tokenCacher.init(0);\n    }\n  }\n\n  cleanIntervals() {\n    for (let interval of this.intervals.typing.concat(this.intervals.misc).concat(this.intervals.kai)) {\n      if (interval) {\n        clearInterval(interval);\n      }\n    }\n  }\n\n  disconnected(autoReconnect = false) {\n\n    this.cleanIntervals();\n\n    this.voiceConnections.forEach(vc => {\n      this.leaveVoiceChannel(vc);\n    });\n\n    if (autoReconnect) {\n      this.autoReconnectInterval = Math.min(this.autoReconnectInterval * (Math.random() + 1), 60000);\n      setTimeout(() => {\n        if (!this.email && !this.token) {\n          return;\n        }\n\n        // Check whether the email is set (if not, only a token has been used for login)\n        this.loginWithToken(this.token, this.email, this.password).catch(() => this.disconnected(true));\n      }, this.autoReconnectInterval);\n    }\n\n    this.client.emit(\"disconnected\");\n  }\n\n  get uptime() {\n    return (this.readyTime ? Date.now() - this.readyTime : null);\n  }\n\n  set userAgent(info) {\n    info.full = `DiscordBot (${info.url}, ${info.version})`;\n    this.userAgentInfo = info;\n  }\n\n  get userAgent() {\n    return this.userAgentInfo;\n  }\n\n  //def leaveVoiceChannel\n  leaveVoiceChannel(chann) {\n    if (this.user.bot) {\n      let leave = (connection) => {\n        return new Promise((resolve) => {\n          connection.destroy();\n          resolve();\n        });\n      };\n\n      if (chann instanceof VoiceChannel) {\n        return this.resolver.resolveChannel(chann).then(channel => {\n          if (!channel) {\n            return Promise.reject(new Error(\"voice channel does not exist\"));\n          }\n\n          if (channel.type !== 2) {\n            return Promise.reject(new Error(\"channel is not a voice channel!\"));\n          }\n\n          let connection = this.voiceConnections.get(\"voiceChannel\", channel);\n          if (!connection) {\n            return Promise.reject(new Error(\"not connected to that voice channel\"));\n          }\n          return leave(connection);\n        });\n      } else if (chann instanceof VoiceConnection) {\n        return leave(chann);\n      } else {\n        return Promise.reject(new Error(\"invalid voice channel/connection to leave\"))\n      }\n    } else {\n      // preserve old functionality for non-bots\n      if (this.voiceConnections[0]) {\n        this.voiceConnections[0].destroy();\n      }\n      return Promise.resolve();\n    }\n  }\n\n  //def awaitResponse\n  awaitResponse(msg) {\n    return new Promise((resolve, reject) => {\n\n      msg = this.resolver.resolveMessage(msg);\n\n      if (!msg) {\n        reject(new Error(\"message undefined\"));\n        return;\n      }\n\n      let awaitID = msg.channel.id + msg.author.id;\n\n      if (!this.messageAwaits[awaitID]) {\n        this.messageAwaits[awaitID] = [];\n      }\n\n      this.messageAwaits[awaitID].push(resolve);\n    });\n  }\n\n  //def joinVoiceChannel\n  joinVoiceChannel(chann) {\n    return this.resolver.resolveChannel(chann).then(channel => {\n      if (!channel) {\n        return Promise.reject(new Error(\"voice channel does not exist\"));\n      }\n\n      if (channel.type !== 2) {\n        return Promise.reject(new Error(\"channel is not a voice channel!\"));\n      }\n\n      let joinSendWS = () => {\n        this.sendWS({\n          op: 4,\n          d: {\n            \"guild_id\": channel.server.id,\n            \"channel_id\": channel.id,\n            \"self_mute\": false,\n            \"self_deaf\": false\n          }\n        });\n      };\n\n      let joinVoice = () => {\n        return new Promise((resolve, reject) => {\n          let session = this.sessionID, token, server = channel.server, endpoint;\n\n          let timeout = null;\n\n          let check = data => {\n            if (data.t === \"VOICE_SERVER_UPDATE\") {\n              if (data.d.guild_id !== server.id) return; // ensure it is the right server\n              token = data.d.token;\n              endpoint = data.d.endpoint;\n              if (!token || !endpoint) return;\n              /* let chan = new VoiceConnection(\n               channel, this.client, session, token, server, endpoint\n               )\n               this.voiceConnections.add(chan); */\n\n              // chan.on(\"ready\", () => resolve(chan));\n              // chan.on(\"error\", reject);\n              // chan.on(\"close\", reject);\n\n              resolve({ channel, client: this.client, session, token, server, endpoint });\n\n              if (timeout) {\n                clearTimeout(timeout);\n              }\n              this.client.removeListener(\"raw\", check);\n            }\n          };\n\n          timeout = setTimeout(() => {\n            this.client.removeListener(\"raw\", check);\n            reject(new Error(\"No voice server details within 10 seconds\"));\n          }, 10000);\n\n          this.client.on(\"raw\", check);\n          joinSendWS();\n        });\n      };\n\n      let existingServerConn = this.voiceConnections.get(\"server\", channel.server); // same server connection\n      if (existingServerConn) {\n        joinSendWS(); // Just needs to update by sending via WS, movement in cache will be handled by global handler\n        return Promise.resolve(existingServerConn);\n      }\n\n      if (!this.user.bot && this.voiceConnections.length > 0) { // nonbot, one voiceconn only, just like last time just disconnect\n        return this.leaveVoiceChannel().then(joinVoice);\n      }\n\n      return joinVoice();\n    });\n  }\n\n  // Backwards-compatible utility getter method for the first voice connection\n  // Thanks to #q (@qeled) for suggesting this\n  get voiceConnection() {\n    return this.voiceConnections[0];\n  }\n\n  getGuildMembers(serverID, chunkCount) {\n    this.forceFetchCount[serverID] = chunkCount;\n    if (this.forceFetchLength + 3 + serverID.length > 4000) { // 4096 max, '{\"op\":8,\"d\":{\"guild_id\":[],\"query\":\"\",\"limit\":0}}'.length = 49 plus some leeway\n      this.requestGuildMembers(this.forceFetchQueue);\n      this.forceFetchQueue = [serverID];\n      this.forceFetchLength = 1 + serverID.length + 3;\n    } else {\n      this.forceFetchQueue.push(serverID);\n      this.forceFetchLength += serverID.length + 3;\n    }\n  }\n\n  requestGuildMembers(serverID, query, limit) {\n    this.sendWS({\n      op: 8,\n      d: {\n        guild_id: serverID,\n        query: query || \"\",\n        limit: limit || 0\n      }\n    });\n  }\n\n  syncGuild(guildID) {\n    if (this.guildSyncQueueLength + 3 + guildID.length > 4050) { // 4096 max, '{\"op\":12,\"d\":[]}'.length = 16 plus some leeway\n      this.sendWS({op: 12, d: this.guildSyncQueue});\n      this.guildSyncQueue = [guildID];\n      this.guildSyncQueueLength = 1 + guildID.length + 3;\n    } else {\n      this.guildSyncQueue.push(guildID);\n      this.guildSyncQueueLength += guildID.length + 3;\n    }\n  }\n\n  checkReady() {\n    if (!this.readyTime) {\n      if (this.guildSyncQueue.length > 0) {\n        this.sendWS({op: 12, d: this.guildSyncQueue});\n        this.guildSyncQueue = [];\n        this.guildSyncQueueLength = 1;\n        return;\n      }\n      if (this.unsyncedGuilds > 0) {\n        return;\n      }\n      if (this.forceFetchQueue.length > 0) {\n        this.requestGuildMembers(this.forceFetchQueue);\n        this.forceFetchQueue = [];\n        this.forceFetchLength = 1;\n      } else {\n        for (let key in this.forceFetchCount) {\n          if (this.forceFetchCount.hasOwnProperty(key)) {\n            return;\n          }\n        }\n        this.readyTime = Date.now();\n        this.client.emit(\"ready\");\n      }\n    }\n  }\n\n  restartServerCreateTimeout() {\n    if (this.guildCreateTimeout) {\n      clearTimeout(this.guildCreateTimeout);\n      this.guildCreateTimeout = null;\n    }\n    if (!this.readyTime) {\n      this.guildCreateTimeout = setTimeout(() => {\n        this.checkReady();\n      }, this.client.options.guildCreateTimeout);\n    }\n  }\n\n  // def createServer\n  createServer(name, region = \"london\") {\n    name = this.resolver.resolveString(name);\n\n    return this.apiRequest('post', Endpoints.SERVERS, true, {name, region})\n      .then(res => {\n        // valid server, wait until it is cached\n        return waitFor(() => this.servers.get(\"id\", res.id));\n      });\n  }\n\n  //def joinServer\n  joinServer(invite) {\n    invite = this.resolver.resolveInviteID(invite);\n    if (!invite) {\n      return Promise.reject(new Error(\"Not a valid invite\"));\n    }\n\n    return this.apiRequest(\"post\", Endpoints.INVITE(invite), true)\n      .then(res => {\n        // valid server, wait until it is received via ws and cached\n        return waitFor(() => this.servers.get(\"id\", res.guild.id));\n      });\n  }\n\n  //def updateServer\n  updateServer(server, options) {\n    server = this.resolver.resolveServer(server);\n    if (!server) {\n      return Promise.reject(new Error(\"server did not resolve\"));\n    }\n\n    let newOptions = {\n      name: options.name || server.name,\n      region: options.region || server.region\n    };\n\n    if (options.icon) {\n      newOptions.icon = this.resolver.resolveToBase64(options.icon);\n    }\n    if (options.splash) {\n      newOptions.splash = this.resolver.resolveToBase64(options.splash);\n    }\n    if (options.owner) {\n      let user = this.resolver.resolveUser(options.owner);\n      if (!user) {\n        return Promise.reject(new Error(\"owner could not be resolved\"));\n      }\n      options.owner_id = user.id;\n    }\n    if (options.verificationLevel) {\n      options.verification_level = user.verificationLevel;\n    }\n    if (options.afkChannel) {\n      let channel = this.resolver.resolveUser(options.afkChannel);\n      if (!channel) {\n        return Promise.reject(new Error(\"afkChannel could not be resolved\"));\n      }\n      options.afk_channel_id = channel.id;\n    }\n    if (options.afkTimeout) {\n      options.afk_timeout = options.afkTimeout;\n    }\n\n    return this.apiRequest(\"patch\", Endpoints.SERVER(server.id), true, options)\n      .then(res => {\n        // wait until the name and region are updated\n        return waitFor(() =>\n          (this.servers.get(\"name\", res.name) ? ((this.servers.get(\"name\", res.name).region === res.region) ? this.servers.get(\"id\", res.id) : false) : false));\n      });\n  }\n\n  //def leaveServer\n  leaveServer(srv) {\n    let server = this.resolver.resolveServer(srv);\n    if (!server) {\n      return Promise.reject(new Error(\"server did not resolve\"));\n    }\n\n    return this.apiRequest(\"del\", Endpoints.ME_SERVER(server.id), true);\n  }\n\n  //def deleteServer\n  deleteServer(srv) {\n    let server = this.resolver.resolveServer(srv);\n    if (!server) {\n      return Promise.reject(new Error(\"server did not resolve\"));\n    }\n\n    return this.apiRequest(\"del\", Endpoints.SERVER(server.id), true);\n  }\n\n  // def loginWithToken\n  // email and password are optional\n  loginWithToken(token, email, password) {\n    console.log(\"login with token, called setup\");\n    if (!this.setupCalled) {\n      this.setup();\n    }\n\n    console.log(\"login with token, setting state to logged in\");\n    this.state = ConnectionState.LOGGED_IN;\n    this.token = token;\n    this.email = email;\n    this.password = password;\n\n    console.log(\"Getting Gateway\");\n    let self = this;\n    return this.getGateway()\n      .then(url => {\n        console.log(\"Got the gateway, creating ws\");\n        self.token = self.client.options.bot && !self.token.startsWith(\"Bot \") ? `Bot ${self.token}` : self.token;\n        self.createWS(url);\n        return self.token;\n      });\n  }\n\n  // def login\n  login(email, password) {\n    let client = this.client;\n\n    if (!this.tokenCacher.done) {\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          this.login(email, password).then(resolve).catch(reject);\n        }, 20);\n      });\n    } else {\n      let tk = this.tokenCacher.getToken(email, password);\n      if (tk) {\n        this.client.emit(\"debug\", \"bypassed direct API login, used cached token\");\n        return this.loginWithToken(tk, email, password);\n      }\n    }\n\n    if (this.state !== ConnectionState.DISCONNECTED && this.state !== ConnectionState.IDLE) {\n      return Promise.reject(new Error(\"already logging in/logged in/ready!\"));\n    }\n\n    this.state = ConnectionState.LOGGING_IN;\n\n    return this.apiRequest(\"post\", Endpoints.LOGIN, false, {\n      email,\n      password\n    })\n      .then(res => {\n        this.client.emit(\"debug\", \"direct API login, cached token was unavailable\");\n        let token = res.token;\n        this.tokenCacher.setToken(email, password, token);\n        return this.loginWithToken(token, email, password);\n      }, error => {\n        this.websocket = null;\n        throw error;\n      })\n      .catch(error => {\n        this.websocket = null;\n        this.state = ConnectionState.DISCONNECTED;\n        client.emit(\"disconnected\");\n        throw error;\n      });\n  }\n\n  // def logout\n  logout() {\n    if (this.state === ConnectionState.DISCONNECTED || this.state === ConnectionState.IDLE) {\n      return Promise.reject(new Error(\"Client is not logged in!\"));\n    }\n\n    let disconnect = () => {\n      if (this.websocket) {\n        this.websocket.close(1000);\n        this.websocket = null;\n      }\n      this.token = null;\n      this.email = null;\n      this.password = null;\n      this.state = ConnectionState.DISCONNECTED;\n      return Promise.resolve();\n    };\n\n    if (!this.user.bot) {\n      return this.apiRequest(\"post\", Endpoints.LOGOUT, true)\n        .then(disconnect);\n    } else {\n      return disconnect();\n    }\n  }\n\n  // def startPM\n  startPM(resUser) {\n    let user = this.resolver.resolveUser(resUser);\n    if (!user) {\n      return Promise.reject(new Error(\"Unable to resolve resUser to a User\"));\n    }\n    // start the PM\n    return this.apiRequest(\"post\", Endpoints.ME_CHANNELS, true, {\n      recipient_id: user.id\n    })\n      .then(res => {\n        return this.private_channels.add(new PMChannel(res, this.client));\n      });\n  }\n\n  // def getGateway\n  getGateway() {\n    if (this.gatewayURL) {\n      return Promise.resolve(this.gatewayURL);\n    }\n    return this.apiRequest(\"get\", Endpoints.GATEWAY, true)\n      .then(res => this.gatewayURL = res.url);\n  }\n\n  // def sendMessage\n  sendMessage(where, _content, options = {}) {\n    if (options.file) {\n      if (typeof options.file !== \"object\") {\n        options.file = {\n          file: options.file\n        };\n      }\n      if (!options.file.name) {\n        if (options.file.file instanceof String || typeof options.file.file === \"string\") {\n          options.file.name = require(\"path\").basename(options.file.file);\n        } else if (options.file.file.path) {\n          // fs.createReadStream()'s have .path that give the path. Not sure about other streams though.\n          options.file.name = require(\"path\").basename(options.file.file.path);\n        } else {\n          options.file.name = \"default.png\"; // Just have to go with default filenames.\n        }\n      }\n    }\n\n    return this.resolver.resolveChannel(where)\n      .then(destination => {\n        let content = this.resolver.resolveString(_content);\n\n        if (this.client.options.disableEveryone || options.disableEveryone) {\n          content = content.replace(/(@)(everyone|here)/g, '$1\\u200b$2');\n        }\n\n        if (options.file) {\n          return this.resolver.resolveFile(options.file.file)\n            .then(file =>\n              this.apiRequest(\"post\", Endpoints.CHANNEL_MESSAGES(destination.id), true, {\n                content: content,\n                tts: options.tts,\n                nonce: options.nonce\n              }, {\n                name: options.file.name,\n                file: file\n              }).then(res => destination.messages.add(new Message(res, destination, this.client)))\n            )\n        } else {\n          return this.apiRequest(\"post\", Endpoints.CHANNEL_MESSAGES(destination.id), true, {\n            content: content,\n            tts: options.tts,\n            nonce: options.nonce\n          })\n            .then(res => destination.messages.add(new Message(res, destination, this.client)));\n        }\n      });\n\n  }\n\n  // def sendFile\n  sendFile(where, _file, name, content) {\n    if (!name) {\n      if (_file instanceof String || typeof _file === \"string\") {\n        name = require(\"path\").basename(_file);\n      } else if (_file && _file.path) {\n        // fs.createReadStream()'s have .path that give the path. Not sure about other streams though.\n        name = require(\"path\").basename(_file.path);\n      } else {\n        name = \"default.png\"; // Just have to go with default filenames.\n      }\n    }\n\n    if (content) {\n      content = {\n        content: this.resolver.resolveString(content)\n      };\n      if (this.client.options.disableEveryone) {\n        content.content = content.content.replace(/(@)(everyone|here)/g, '$1\\u200b$2');\n      }\n    }\n\n    return this.resolver.resolveChannel(where)\n      .then(channel =>\n        this.resolver.resolveFile(_file)\n          .then(file =>\n            this.apiRequest(\"post\", Endpoints.CHANNEL_MESSAGES(channel.id), true, content, {\n              name,\n              file\n            }).then(res => channel.messages.add(new Message(res, channel, this.client)))\n          )\n      );\n  }\n\n  // def deleteMessage\n  deleteMessage(_message, options = {}) {\n\n    let message = this.resolver.resolveMessage(_message);\n    if (!message) {\n      return Promise.reject(new Error(\"Supplied message did not resolve to a message!\"));\n    }\n\n    let chain = options.wait ? delay(options.wait) : Promise.resolve();\n    return chain.then(() =>\n      this.apiRequest(\"del\", Endpoints.CHANNEL_MESSAGE(message.channel.id, message.id), true)\n    )\n      .then(() => message.channel.messages.remove(message));\n  }\n\n  // def deleteMessages\n  deleteMessages(_messages) {\n    if (!_messages instanceof Array)\n      return Promise.reject(new Error(\"Messages provided must be in an array\"));\n    if (_messages.length < 1)\n      return Promise.reject(new Error(\"You must provide at least one message to delete\"));\n    else if (_messages.length === 1)\n      return this.deleteMessage(_messages[0]);\n\n\n    let messages = [];\n    let channel;\n    let message;\n    for (let _message of _messages) {\n      message = this.resolver.resolveMessage(_message);\n      if (!message)\n        return Promise.reject(new Error(\"Something other than a message could not be resolved in the array...\"));\n      if (!message.server)\n        return Promise.reject(new Error(\"You can only bulk delete messages on guild channels\"));\n\n      // ensure same channel\n      if (!channel) {\n        channel = message.channel;\n      } else {\n        //noinspection JSUnusedAssignment\n        if (message.channel.id !== channel.id)\n          return Promise.reject(new Error(\"You can only bulk delete messages from the same channel at one time...\"));\n      }\n\n      messages.push(message);\n    }\n\n    return this.apiRequest(\"post\", `${Endpoints.CHANNEL_MESSAGES(channel.id)}/bulk_delete`, true, {\n      messages: messages.map(m => m.id)\n    })\n      .then(() => messages.forEach(m => channel.messages.remove(m)));\n  }\n\n  // def updateMessage\n  updateMessage(msg, _content, options = {}) {\n\n    let message = this.resolver.resolveMessage(msg);\n\n    if (!message) {\n      return Promise.reject(new Error(\"Supplied message did not resolve to a message!\"));\n    }\n\n    let content = this.resolver.resolveString(_content);\n\n    return this.apiRequest(\n      \"patch\",\n      Endpoints.CHANNEL_MESSAGE(message.channel.id, message.id),\n      true,\n      {\n        content: content,\n        tts: options.tts\n      }\n    )\n      .then(res => message.channel.messages.update(\n        message,\n        new Message(res, message.channel, this.client)\n      ));\n  }\n\n  // def getChannelLogs\n  getChannelLogs(_channel, limit = 50, options = {}) {\n    return this.resolver.resolveChannel(_channel)\n      .then(channel => {\n        let qsObject = {limit};\n        if (options.before) {\n          const res = this.resolver.resolveMessage(options.before);\n          if (res) {\n            qsObject.before = res.id;\n          }\n        }\n        if (options.after) {\n          const res = this.resolver.resolveMessage(options.after);\n          if (res) {\n            qsObject.after = res.id;\n          }\n        }\n        if (options.around) {\n          const res = this.resolver.resolveMessage(options.around);\n          if (res) {\n            qsObject.around = res.id\n          }\n        }\n\n        return this.apiRequest(\n          \"get\",\n          `${Endpoints.CHANNEL_MESSAGES(channel.id)}?${qs.stringify(qsObject)}`,\n          true\n        )\n          .then(res => res.map(\n            msg => channel.messages.add(new Message(msg, channel, this.client))\n          ));\n      });\n  }\n\n  // def getMessage\n  getMessage(_channel, messageID) {\n    return this.resolver.resolveChannel(_channel)\n      .then(channel => {\n        if (!this.user.bot) {\n          return Promise.reject(new Error(\"Only OAuth bot accounts can use this function\"));\n        }\n\n        if (!(channel instanceof TextChannel || channel instanceof PMChannel)) {\n          return Promise.reject(new Error(\"Provided channel is not a Text or PMChannel\"));\n        }\n\n        let msg = channel.messages.get(\"id\", messageID);\n        if (msg) {\n          return Promise.resolve(msg);\n        }\n\n        return this.apiRequest(\n          \"get\",\n          `${Endpoints.CHANNEL_MESSAGES(channel.id)}/${messageID}`,\n          true\n        )\n          .then(res => channel.messages.add(\n            new Message(res, channel, this.client)\n          ));\n      });\n  }\n\n  // def pinMessage\n  pinMessage(msg) {\n    let message = this.resolver.resolveMessage(msg);\n\n    if (!message) {\n      return Promise.reject(new Error(\"Supplied message did not resolve to a message\"));\n    }\n\n    return this.apiRequest(\n      \"put\",\n      `${Endpoints.CHANNEL_PIN(msg.channel.id, msg.id)}`,\n      true\n    );\n  }\n\n  // def unpinMessage\n  unpinMessage(msg) {\n    let message = this.resolver.resolveMessage(msg);\n\n    if (!message) {\n      return Promise.reject(new Error(\"Supplied message did not resolve to a message\"));\n    }\n\n    if (!message.pinned) {\n      return Promise.reject(new Error(\"Supplied message is not pinned\"));\n    }\n\n    return this.apiRequest(\n      \"del\",\n      `${Endpoints.CHANNEL_PIN(msg.channel.id, msg.id)}`,\n      true\n    );\n  }\n\n  // def getPinnedMessages\n  getPinnedMessages(_channel) {\n    return this.resolver.resolveChannel(_channel)\n      .then(channel => {\n        return this.apiRequest(\n          \"get\",\n          `${Endpoints.CHANNEL_PINS(channel.id)}`,\n          true\n        )\n          .then(res => res.map(\n            msg => channel.messages.add(new Message(msg, channel, this.client))\n          ));\n      });\n  }\n\n  // def getBans\n  getBans(server) {\n    server = this.resolver.resolveServer(server);\n\n    return this.apiRequest(\"get\", Endpoints.SERVER_BANS(server.id), true)\n      .then(res => res.map(\n        ban => this.users.add(new User(ban.user, this.client))\n      ));\n  }\n\n  // def createChannel\n  createChannel(server, name, type = 0) {\n\n    server = this.resolver.resolveServer(server);\n\n    return this.apiRequest(\"post\", Endpoints.SERVER_CHANNELS(server.id), true, {\n      name,\n      type\n    })\n      .then(res => {\n        let channel;\n        if (res.type === 0) {\n          channel = new TextChannel(res, this.client, server);\n        } else {\n          channel = new VoiceChannel(res, this.client, server);\n        }\n        return server.channels.add(this.channels.add(channel));\n      });\n  }\n\n  // def deleteChannel\n  deleteChannel(_channel) {\n\n    return this.resolver.resolveChannel(_channel)\n      .then(channel =>\n        this.apiRequest(\"del\", Endpoints.CHANNEL(channel.id), true)\n          .then(() => {\n            if (channel.server) {\n              channel.server.channels.remove(channel);\n              this.channels.remove(channel);\n            } else {\n              this.private_channels.remove(channel);\n            }\n          })\n      );\n  }\n\n  // def banMember\n  banMember(user, server, length = 1) {\n    let resolvedUser = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n\n    if (resolvedUser === null && typeof user === \"string\") {\n      user = {id: user};\n    } else {\n      user = resolvedUser;\n    }\n\n    return this.apiRequest(\n      \"put\",\n      `${Endpoints.SERVER_BANS(server.id)}/${user.id}?delete-message-days=${length}`,\n      true\n    );\n  }\n\n  // def unbanMember\n  unbanMember(user, server) {\n\n    server = this.resolver.resolveServer(server);\n    let resolvedUser = this.resolver.resolveUser(user);\n\n    if (resolvedUser === null && typeof user === \"string\") {\n      user = {id: user};\n    } else {\n      user = resolvedUser;\n    }\n\n    return this.apiRequest(\"del\", `${Endpoints.SERVER_BANS(server.id)}/${user.id}`, true)\n  }\n\n  // def kickMember\n  kickMember(user, server) {\n    user = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n\n    return this.apiRequest(\"del\", `${Endpoints.SERVER_MEMBERS(server.id) }/${user.id}`, true);\n  }\n\n  // def moveMember\n  moveMember(user, channel) {\n    user = this.resolver.resolveUser(user);\n    return this.resolver.resolveChannel(channel).then(channel => {\n      let server = channel.server;\n\n      // Make sure `channel` is a voice channel\n      if (channel.type !== 2) {\n        throw new Error(\"Can't moveMember into a non-voice channel\");\n      } else {\n        return this.apiRequest(\"patch\", `${Endpoints.SERVER_MEMBERS(server.id)}/${user.id}`, true, {channel_id: channel.id})\n          .then(res => {\n            user.voiceChannel = channel;\n            return res;\n          });\n      }\n    });\n  }\n\n  // def muteMember\n  muteMember(user, server) {\n    user = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n    return this.apiRequest(\"patch\", `${Endpoints.SERVER_MEMBERS(server.id)}/${user.id}`, true, {mute: true});\n  }\n\n  // def unmuteMember\n  unmuteMember(user, server) {\n    user = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n    return this.apiRequest(\"patch\", `${Endpoints.SERVER_MEMBERS(server.id)}/${user.id}`, true, {mute: false});\n  }\n\n  // def deafenMember\n  deafenMember(user, server) {\n    user = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n    return this.apiRequest(\"patch\", `${Endpoints.SERVER_MEMBERS(server.id)}/${user.id}`, true, {deaf: true});\n  }\n\n  // def undeafenMember\n  undeafenMember(user, server) {\n    user = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n    return this.apiRequest(\"patch\", `${Endpoints.SERVER_MEMBERS(server.id)}/${user.id}`, true, {deaf: false});\n  }\n\n  // def setNickname\n  setNickname(server, nick, user) {\n    nick = nick || \"\";\n    user = this.resolver.resolveUser(user);\n    server = this.resolver.resolveServer(server);\n    return this.apiRequest(\"patch\", `${Endpoints.SERVER_MEMBERS(server.id)}/${user.id === this.user.id ? \"@me/nick\" : user.id}`, true, {nick: nick});\n  }\n\n  //def setNote\n  setNote(user, note) {\n    user = this.resolver.resolveUser(user);\n    note = note || \"\";\n\n    if (!user) {\n      return Promise.reject(new Error(\"Failed to resolve user\"));\n    }\n\n    return this.apiRequest(\"put\", `${Endpoints.ME_NOTES}/${user.id}`, true, {note: note});\n  }\n\n  // def createRole\n  createRole(server, data) {\n    server = this.resolver.resolveServer(server);\n\n    return this.apiRequest(\"post\", Endpoints.SERVER_ROLES(server.id), true)\n      .then(res => {\n        let role = server.roles.add(new Role(res, server, this.client));\n\n        if (data) {\n          return this.updateRole(role, data);\n        }\n        return role;\n      });\n  }\n\n  // def updateRole\n  updateRole(role, data) {\n\n    role = this.resolver.resolveRole(role);\n    let server = this.resolver.resolveServer(role.server);\n\n    let newData = {\n      color: \"color\" in data ? data.color : role.color,\n      hoist: \"hoist\" in data ? data.hoist : role.hoist,\n      name: \"name\" in data ? data.name : role.name,\n      position: \"position\" in data ? data.position : role.position,\n      permissions: \"permissions\" in data ? data.permissions : role.permissions,\n      mentionable: \"mentionable\" in data ? data.mentionable : role.mentionable\n    };\n\n    if (data.permissions) {\n      newData.permissions = 0;\n      for (let perm of data.permissions) {\n        if (perm instanceof String || typeof perm === \"string\") {\n          newData.permissions |= (Permissions[perm] || 0);\n        } else {\n          newData.permissions |= perm;\n        }\n      }\n    }\n\n    return this.apiRequest(\"patch\", `${Endpoints.SERVER_ROLES(server.id)}/${role.id}`, true, newData)\n      .then(res => {\n        return server.roles.update(role, new Role(res, server, this.client));\n      });\n  }\n\n  // def deleteRole\n  deleteRole(role) {\n    if (role.server.id === role.id) {\n      return Promise.reject(new Error(\"Stop trying to delete the @everyone role. It is futile\"));\n    } else {\n      return this.apiRequest(\"del\", `${Endpoints.SERVER_ROLES(role.server.id)}/${role.id}`, true);\n    }\n  }\n\n  //def addMemberToRole\n  addMemberToRole(member, roles) {\n    member = this.resolver.resolveUser(member);\n\n    if (!member) {\n      return Promise.reject(new Error(\"user not found\"));\n    }\n\n    if (!Array.isArray(roles) || roles.length === 0) {\n      roles = this.resolver.resolveRole(roles);\n      if (roles) {\n        roles = [roles];\n      } else {\n        return Promise.reject(new Error(\"invalid array of roles\"));\n      }\n    } else {\n      roles = roles.map(r => this.resolver.resolveRole(r));\n    }\n\n    if (roles.some(role => !role.server.memberMap[member.id])) {\n      return Promise.reject(new Error(\"Role does not exist on same server as member\"));\n    }\n\n    let roleIDs = roles[0].server.memberMap[member.id].roles.map(r => (r && r.id) || r);\n\n    for (let i = 0; i < roles.length; i++) {\n      if (!~roleIDs.indexOf(roles[i].id)) {\n        roleIDs.push(roles[i].id);\n      }\n    }\n\n    return this.apiRequest(\n      \"patch\",\n      `${Endpoints.SERVER_MEMBERS(roles[0].server.id)}/${member.id}`,\n      true,\n      {\n        roles: roleIDs\n      }\n    );\n  }\n\n  memberHasRole(member, role) {\n    role = this.resolver.resolveRole(role);\n    member = this.resolver.resolveUser(member);\n\n    if (!role) {\n      throw new Error(\"invalid role\");\n    }\n    if (!member) {\n      throw new Error(\"user not found\");\n    }\n\n    let roledata = role.server.rolesOf(member);\n    if (roledata) {\n      for (let r of roledata) {\n        if (r.id == role.id) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  //def removeMemberFromRole\n  removeMemberFromRole(member, roles) {\n    member = this.resolver.resolveUser(member);\n\n    if (!member) {\n      return Promise.reject(new Error(\"user not found\"));\n    }\n\n    if (!Array.isArray(roles) || roles.length === 0) {\n      roles = this.resolver.resolveRole(roles);\n      if (roles) {\n        roles = [roles];\n      } else {\n        return Promise.reject(new Error(\"invalid array of roles\"));\n      }\n    } else {\n      roles = roles.map(r => this.resolver.resolveRole(r));\n    }\n\n    let roleIDs = roles[0].server.memberMap[member.id].roles.map(r => (r && r.id) || r);\n\n    for (let role of roles) {\n      if (!role.server.memberMap[member.id]) {\n        return Promise.reject(new Error(\"member not in server\"));\n      }\n      for (let item in roleIDs) {\n        if (roleIDs.hasOwnProperty(item)) {\n          if (roleIDs[item] === role.id) {\n            roleIDs.splice(item, 1);\n            break;\n          }\n        }\n      }\n    }\n\n    return this.apiRequest(\n      \"patch\",\n      `${Endpoints.SERVER_MEMBERS(roles[0].server.id)}/${member.id}`,\n      true,\n      {\n        roles: roleIDs\n      }\n    );\n  }\n\n  // def createInvite\n  createInvite(chanServ, options) {\n    return this.resolver.resolveChannel(chanServ)\n      .then(channel => {\n        if (!options) {\n          options = {\n            validate: null\n          };\n        } else {\n          options.max_age = options.maxAge || 0;\n          options.max_uses = options.maxUses || 0;\n          options.temporary = options.temporary || false;\n          options.xkcdpass = options.xkcd || false;\n        }\n\n        return this.apiRequest(\"post\", Endpoints.CHANNEL_INVITES(channel.id), true, options)\n          .then(res => new Invite(res, this.channels.get(\"id\", res.channel.id), this.client));\n      });\n  }\n\n  //def deleteInvite\n  deleteInvite(invite) {\n    invite = this.resolver.resolveInviteID(invite);\n    if (!invite) {\n      throw new Error(\"Not a valid invite\");\n    }\n    return this.apiRequest(\"del\", Endpoints.INVITE(invite), true);\n  }\n\n  //def getInvite\n  getInvite(invite) {\n    invite = this.resolver.resolveInviteID(invite);\n    if (!invite) {\n      return Promise.reject(new Error(\"Not a valid invite\"));\n    }\n\n    return this.apiRequest(\"get\", Endpoints.INVITE(invite), true)\n      .then(res => {\n        if (!this.channels.has(\"id\", res.channel.id)) {\n          return new Invite(res, null, this.client);\n        }\n        return this.apiRequest(\"post\", Endpoints.CHANNEL_INVITES(res.channel.id), true, {validate: invite})\n          .then(res2 => new Invite(res2, this.channels.get(\"id\", res.channel.id), this.client));\n      });\n  }\n\n  //def getInvites\n  getInvites(channel) {\n    if (!(channel instanceof Channel)) {\n      let server = this.resolver.resolveServer(channel);\n      if (server) {\n        return this.apiRequest(\"get\", Endpoints.SERVER_INVITES(server.id), true)\n          .then(res => {\n            return res.map(data => new Invite(data, this.channels.get(\"id\", data.channel.id), this.client));\n          });\n      }\n    }\n    return this.resolver.resolveChannel(channel)\n      .then(channel => {\n        return this.apiRequest(\"get\", Endpoints.CHANNEL_INVITES(channel.id), true)\n          .then(res => {\n            return res.map(data => new Invite(data, this.channels.get(\"id\", data.channel.id), this.client));\n          });\n      });\n  }\n\n  //def overwritePermissions\n  overwritePermissions(channel, role, updated) {\n    return this.resolver.resolveChannel(channel)\n      .then(channel => {\n        if (!channel instanceof ServerChannel) {\n          return Promise.reject(new Error(\"Not a server channel\"));\n        }\n\n        let data = {\n          allow: 0,\n          deny: 0\n        };\n\n        if (role instanceof String || typeof role === \"string\") {\n          role = this.resolver.resolveUser(role) || this.resolver.resolveRole(role);\n        }\n\n        if (role instanceof User) {\n          data.id = role.id;\n          data.type = \"member\";\n        } else if (role instanceof Role) {\n          data.id = role.id;\n          data.type = \"role\";\n        } else {\n          return Promise.reject(new Error(\"Role could not be resolved\"));\n        }\n\n        let previousOverwrite = channel.permissionOverwrites.get(\"id\", data.id);\n\n        if (previousOverwrite) {\n          data.allow |= previousOverwrite.allow;\n          data.deny |= previousOverwrite.deny;\n        }\n\n        for (let perm in updated) {\n          if (updated.hasOwnProperty(perm)) {\n            if (updated[perm] === true) {\n              data.allow |= (Permissions[perm] || 0);\n              data.deny &= ~(Permissions[perm] || 0);\n            } else if (updated[perm] === false) {\n              data.allow &= ~(Permissions[perm] || 0);\n              data.deny |= (Permissions[perm] || 0);\n            } else {\n              data.allow &= ~(Permissions[perm] || 0);\n              data.deny &= ~(Permissions[perm] || 0);\n            }\n          }\n        }\n\n        return this.apiRequest(\n          \"put\",\n          `${Endpoints.CHANNEL_PERMISSIONS(channel.id)}/${data.id}`,\n          true,\n          data\n        );\n      });\n  }\n\n  //def setStatus\n  setStatus(idleStatus, game) {\n\n    if (idleStatus === \"online\" || idleStatus === \"here\" || idleStatus === \"available\") {\n      this.idleStatus = null;\n    }\n    else if (idleStatus === \"idle\" || idleStatus === \"away\") {\n      this.idleStatus = Date.now();\n    }\n    else {\n      this.idleStatus = this.idleStatus || null; //undefined\n    }\n\n    // convert undefined and empty string to null\n    if (typeof game === \"string\" && !game.length) game = null;\n\n    this.game = game === null ? null : !game ? this.game || null : typeof game === \"string\" ? {name: game} : game;\n\n    let packet = {\n      op: 3,\n      d: {\n        idle_since: this.idleStatus,\n        game: this.game\n      }\n    };\n\n    this.sendWS(packet);\n\n    this.user.status = this.idleStatus ? \"idle\" : \"online\";\n    this.user.game = this.game;\n\n    return Promise.resolve();\n\n  }\n\n  //def sendTyping\n  sendTyping(channel) {\n    return this.resolver.resolveChannel(channel).then(channel =>\n      this.apiRequest(\"post\", Endpoints.CHANNEL(channel.id) + \"/typing\", true)\n    );\n  }\n\n  //def startTyping\n  startTyping(channel) {\n    return this.resolver.resolveChannel(channel)\n      .then(channel => {\n\n        if (this.intervals.typing[channel.id]) {\n          // typing interval already exists, leave it alone\n          throw new Error(\"Already typing in that channel\");\n        }\n\n        this.intervals.typing[channel.id] = setInterval(\n          () => this.sendTyping(channel)\n            .catch(error => this.client.emit(\"error\", error)),\n          4000\n        );\n\n        return this.sendTyping(channel);\n      });\n\n  }\n\n  //def stopTyping\n  stopTyping(channel) {\n    return this.resolver.resolveChannel(channel)\n      .then(channel => {\n\n        if (!this.intervals.typing[channel.id]) {\n          // typing interval doesn\"t exist\n          throw new Error(\"Not typing in that channel\");\n        }\n\n        clearInterval(this.intervals.typing[channel.id]);\n        this.intervals.typing[channel.id] = false;\n\n      });\n  }\n\n  //def updateDetails\n  updateDetails(data) {\n    if (!this.user.bot && !(this.email || data.email)) {\n      throw new Error(\"Must provide email since a token was used to login\");\n    }\n\n    let options = {};\n\n    if (data.username) {\n      options.username = data.username;\n    } else {\n      options.username = this.user.username;\n    }\n\n    if (data.avatar) {\n      options.avatar = this.resolver.resolveToBase64(data.avatar);\n    }\n\n    if (this.email || data.email) {\n      options.email = data.email || this.email;\n      options.new_password = data.newPassword || null;\n      options.password = data.password || this.password;\n    }\n\n    return this.apiRequest(\"patch\", Endpoints.ME, true, options);\n  }\n\n  //def setAvatar\n  setAvatar(avatar) {\n    return this.updateDetails({avatar});\n  }\n\n  //def setUsername\n  setUsername(username) {\n    return this.updateDetails({username});\n  }\n\n  //def setChannelTopic\n  setChannelTopic(channel, topic = \"\") {\n    topic = topic || \"\";\n\n    return this.updateChannel(channel, {topic: topic});\n  }\n\n  //def setChannelName\n  setChannelName(channel, name) {\n    name = name || \"unnamed-channel\";\n\n    return this.updateChannel(channel, {name: name});\n  }\n\n  //def setChannelPosition\n  setChannelPosition(channel, position) {\n    position = position || 0;\n\n    return this.updateChannel(channel, {position: position});\n  }\n\n  //def setChannelUserLimit\n  setChannelUserLimit(channel, limit) {\n    limit = limit || 0; // default 0 = no limit\n\n    return this.updateChannel(channel, {userLimit: limit})\n  }\n\n  //def setChannelBitrate\n  setChannelBitrate(channel, kbitrate) {\n    kbitrate = kbitrate || 64; // default 64kbps\n\n    return this.updateChannel(channel, {bitrate: kbitrate});\n  }\n\n  //def updateChannel\n  updateChannel(channel, data) {\n    return this.resolver.resolveChannel(channel).then(channel => {\n      if (!channel) {\n        return Promise.reject(new Error(\"Failed to resolve channel\"));\n      }\n\n      data = {\n        name: data.name || channel.name,\n        topic: data.topic || channel.topic,\n        position: (data.position ? data.position : channel.position),\n        user_limit: (data.userLimit ? data.userLimit : channel.userLimit),\n        bitrate: (data.bitrate ? data.bitrate : channel.bitrate ? channel.bitrate : undefined)\n      };\n\n      if (data.position < 0) {\n        return Promise.reject(new Error(\"Position cannot be less than 0\"));\n      }\n\n      if (data.user_limit < 0 || data.user_limit > 99) {\n        return Promise.reject(new Error(\"User limit must be between 0-99\"));\n      }\n\n      if (data.kbitrate < 8 || data.kbitrate > 96) {\n        return Promise.reject(new Error(\"Bitrate must be between 8-96kbps\"));\n      }\n\n      if (data.bitrate) {\n        data.bitrate *= 1000; // convert to bits before sending\n      }\n\n      return this.apiRequest(\"patch\", Endpoints.CHANNEL(channel.id), true, data)\n        .then(res => {\n          channel.name = data.name;\n          channel.topic = data.topic;\n          channel.position = data.position;\n          channel.userLimit = data.user_limit;\n          channel.bitrate = Math.ceil(data.bitrate / 1000);\n          channel._bitrate = data.bitrate;\n        });\n    });\n  }\n\n  //def addFriend\n  addFriend(user) {\n    if (this.user.bot) return Promise.reject(new Error(\"user is a bot, bot's do not have friends support\"));\n\n    let id;\n    if (user instanceof String || typeof user === \"string\")\n      id = user;\n    else if (user instanceof User) {\n      user = this.resolver.resolveUser(user);\n      id = user.id\n    } else {\n      if (user.username && user.discriminator) // add by username and discriminator (pass in an object)\n        return this.apiRequest(\"put\", Endpoints.FRIENDS, true, user);\n      else\n        return Promise.reject(\"invalid user\")\n    }\n\n    return this.apiRequest(\"put\", `${Endpoints.FRIENDS}/${id}`, true, {});\n  }\n\n  //def removeFriend\n  removeFriend(user) {\n    if (this.user.bot) return Promise.reject(new Error(\"user is a bot, bot's do not have friends support\"));\n\n    user = this.resolver.resolveUser(user);\n\n    return this.apiRequest(\"delete\", `${Endpoints.FRIENDS}/${user.id}`, true);\n  }\n\n  getServerWebhooks(server) {\n    server = this.resolver.resolveServer(server);\n\n    if (!server) {\n      return Promise.reject(new Error(\"Failed to resolve server\"));\n    }\n\n    return this.apiRequest(\"get\", Endpoints.SERVER_WEBHOOKS(server.id), true)\n      .then(res => res.map(\n        webhook => {\n          let channel = this.channels.get(\"id\", webhook.channel_id);\n          return channel.webhooks.add(new Webhook(\n            webhook,\n            server,\n            channel,\n            this.users.get(\"id\", webhook.user.id)\n          ))\n        }\n      ));\n  }\n\n  getChannelWebhooks(channel) {\n    return this.resolver.resolveChannel(channel).then(channel => {\n      if (!channel) {\n        return Promise.reject(new Error(\"Failed to resolve channel\"));\n      }\n\n      return this.apiRequest(\"get\", Endpoints.CHANNEL_WEBHOOKS(channel.id), true)\n        .then(res => res.map(\n          webhook => channel.webhooks.add(new Webhook(\n            webhook,\n            this.servers.get(\"id\", webhook.guild_id),\n            channel,\n            this.users.get(\"id\", webhook.user.id)\n          ))\n        ));\n    })\n  }\n\n  editWebhook(webhook, options = {}) {\n    return this.resolver.resolveWebhook(webhook).then(webhook => {\n      if (!webhook) {\n        return Promise.reject(new Error(\" Failed to resolve webhook\"))\n      }\n\n      if (options.hasOwnProperty(\"avatar\")) {\n        options.avatar = this.resolver.resolveToBase64(options.avatar);\n      }\n\n      return this.apiRequest(\"patch\", Endpoints.WEBHOOK(webhook.id), true, options)\n        .then(res => {\n          webhook.name = res.name;\n          webhook.avatar = res.hasOwnProperty('avatar') ? res.avatar : webhook.avatar;\n        });\n    })\n  }\n\n  createWebhook(channel, options = {}) {\n    return this.resolver.resolveChannel(channel)\n      .then(destination => {\n        if (!channel) {\n          return Promise.reject(new Error(\" Failed to resolve channel\"))\n        }\n\n        if (options.hasOwnProperty(\"avatar\")) {\n          options.avatar = this.resolver.resolveToBase64(options.avatar);\n        }\n\n        return this.apiRequest(\"post\", Endpoints.CHANNEL_WEBHOOKS(destination.id), true, options)\n          .then(webhook => channel.webhooks.add(new Webhook(\n            webhook,\n            this.servers.get(\"id\", webhook.guild_id),\n            channel,\n            this.users.get(\"id\", webhook.user.id)\n          )));\n      });\n  }\n\n  deleteWebhook(webhook) {\n    return this.resolver.resolveWebhook(webhook).then(webhook => {\n      if (!webhook) {\n        return Promise.reject(new Error(\" Failed to resolve webhook\"))\n      }\n\n      return this.apiRequest(\"delete\", Endpoints.WEBHOOK(webhook.id), true)\n        .then(() => {\n          webhook.channel.webhooks.remove(webhook);\n        });\n    })\n  }\n\n  sendWebhookMessage(webhook, _content, options = {}) {\n    return this.resolver.resolveWebhook(webhook)\n      .then(destination => {\n        let content = this.resolver.resolveString(_content);\n\n        if (this.client.options.disableEveryone || options.disableEveryone) {\n          content = content.replace(/(@)(everyone|here)/g, '$1\\u200b$2');\n        }\n\n        if (!options.hasOwnProperty(\"username\")) {\n          options.username = this.user.username;\n        }\n\n        let slack;\n        if (options.hasOwnProperty(\"slack\")) {\n          slack = options.slack;\n          delete options[\"slack\"];\n        }\n\n        options.content = content;\n\n        return this.apiRequest(\n          \"post\",\n          `${Endpoints.WEBHOOK_MESSAGE(destination.id, destination.token)}${slack ? \"/slack\" : \"\"}?wait=true`,\n          true,\n          options\n        )\n      });\n\n  }\n\n  //def getOAuthApplication\n  getOAuthApplication(appID) {\n    appID = appID || \"@me\";\n    return this.apiRequest(\"get\", Endpoints.OAUTH2_APPLICATION(appID), true);\n  }\n\n  //def ack\n  ack(msg) {\n    msg = this.resolver.resolveMessage(msg);\n\n    if (!msg) {\n      return Promise.reject(new Error(\"Message does not exist\"));\n    }\n\n    return this.apiRequest(\"post\", Endpoints.CHANNEL_MESSAGE(msg.channel.id, msg.id) + \"/ack\", true);\n  }\n\n  sendWS(object) {\n    if (this.websocket) {\n      //noinspection NodeModulesDependencies,NodeModulesDependencies\n      this.websocket.send(JSON.stringify(object));\n    }\n  }\n\n  createWS(url) {\n    if (this.websocket) {\n      return false;\n    }\n    if (!url.endsWith(\"/\")) {\n      url += \"/\";\n    }\n    url += \"?encoding=json&v=\" + GATEWAY_VERSION;\n\n    this.websocket = new WebSocket(url);\n\n    this.websocket.onopen = () => {\n    };\n\n    this.websocket.onclose = (event) => {\n      console.log(\"websocket closed\");\n      this.websocket = null;\n      this.state = ConnectionState.DISCONNECTED;\n      if (event && event.code) {\n        console.error(\"close event\", event, event.code);\n        this.client.emit(\"warn\", \"WS close: \" + event.code);\n        let err;\n        if (event.code === 1006) {\n          this.setup();\n          err = new Error(\"Error 1006, god knows\");\n        } else if (event.code === 4001) {\n          err = new Error(\"Gateway received invalid OP code\");\n        } else if (event.code === 4005) {\n          err = new Error(\"Gateway received invalid message\");\n        } else if (event.code === 4003) {\n          err = new Error(\"Not authenticated\");\n        } else if (event.code === 4004) {\n          err = new Error(\"Authentication failed\");\n        } else if (event.code === 4005) {\n          err = new Error(\"Already authenticated\");\n        } else if (event.code === 4006 || event.code === 4009) {\n          err = new Error(\"Invalid session\");\n        } else if (event.code === 4007) {\n          this.sequence = 0;\n          err = new Error(\"Invalid sequence number\");\n        } else if (event.code === 4008) {\n          err = new Error(\"Gateway connection was ratelimited\");\n        } else if (event.code === 4010) {\n          err = new Error(\"Invalid shard key\");\n        }\n        if (err) {\n          this.client.emit(\"error\", err);\n        }\n      }\n      this.disconnected(this.client.options.autoReconnect);\n    };\n\n    this.websocket.onerror = e => {\n      this.client.emit(\"error\", e);\n      this.websocket = null;\n      this.state = ConnectionState.DISCONNECTED;\n      this.disconnected(this.client.options.autoReconnect);\n    };\n\n    this.websocket.onmessage = e => {\n      if (e.data instanceof Buffer) {\n        if (!zlib) zlib = require(\"zlib\");\n        e.data = zlib.inflateSync(e.data).toString();\n      }\n\n      let packet;\n      try {\n        packet = JSON.parse(e.data);\n      } catch (e) {\n        this.client.emit(\"error\", e);\n        return;\n      }\n\n      this.client.emit(\"raw\", packet);\n\n      if (packet.s) {\n        this.sequence = packet.s;\n      }\n\n      switch (packet.op) {\n        case 0:\n          this.processPacket(packet);\n          break;\n        case 1:\n          console.log(\"set it to true 1\");\n          this.heartbeatAcked = true;\n          this.heartbeat();\n          break;\n        case 7:\n          console.log(\"received reconnect\");\n          this.disconnected(true);\n          break;\n        case 9:\n          console.log(\"received invalidate session\");\n          this.sessionID = null;\n          this.sequence = 0;\n          this.identify();\n          break;\n        case 10:\n          console.log(\"got a packet with op code 10\");\n          if (this.sessionID) {\n            console.log(\"we have a session id, calling resume\");\n            this.resume();\n          } else {\n            console.log(\"we don't have a session id, calling identify\");\n            this.identify();\n          }\n          console.log(\"set it to true 10 1\");\n          this.heartbeatAcked = true; // start off without assuming we didn't get a missed heartbeat acknowledge right away;\n          this.heartbeat();\n          console.log(\"set it to true 10 2\");\n          this.heartbeatAcked = true;\n          this.intervals.kai = setInterval(() => this.heartbeat(), packet.d.heartbeat_interval);\n          break;\n        case 11:\n          console.log(\"set heartbeatAcked to true because heartbeat was acked.\");\n          this.heartbeatAcked = true;\n          break;\n        default:\n          this.client.emit(\"unknown\", packet);\n          break;\n      }\n    };\n  }\n\n  processPacket(packet) {\n    let client = this.client;\n    let data = packet.d;\n    switch (packet.t) {\n      case PacketType.RESUMED:\n      case PacketType.READY: {\n        console.log('got ready or resume, type', packet.t);\n        this.autoReconnectInterval = 1000;\n        this.state = ConnectionState.READY;\n\n        if (packet.t === PacketType.RESUMED) {\n          break;\n        }\n\n        this.sessionID = data.session_id;\n        let startTime = Date.now();\n\n        this.user = this.users.add(new User(data.user, client));\n\n        this.forceFetchCount = {};\n        this.forceFetchQueue = [];\n        this.forceFetchLength = 1;\n\n        data.guilds.forEach(server => {\n          if (!server.unavailable) {\n            server = this.servers.add(new Server(server, client));\n            if (client.options.bot === false) {\n              this.unsyncedGuilds++;\n              this.syncGuild(server.id);\n            }\n            if (this.client.options.forceFetchUsers && server.members && server.members.length < server.memberCount) {\n              this.getGuildMembers(server.id, Math.ceil(server.memberCount / 1000));\n            }\n          } else {\n            client.emit(\"debug\", \"server \" + server.id + \" was unavailable, could not create (ready)\");\n            this.unavailableServers.add(server);\n          }\n        });\n        data.private_channels.forEach(pm => {\n          this.private_channels.add(new PMChannel(pm, client));\n        });\n        if (!data.user.bot) { // bots dont have friends\n          data.relationships.forEach(friend => {\n            if (friend.type === 1) { // is a friend\n              this.friends.add(new User(friend.user, client));\n            } else if (friend.type === 2) { // incoming friend requests\n              this.blocked_users.add(new User(friend.user, client));\n            } else if (friend.type === 3) { // incoming friend requests\n              this.incoming_friend_requests.add(new User(friend.user, client));\n            } else if (friend.type === 4) { // outgoing friend requests\n              this.outgoing_friend_requests.add(new User(friend.user, client));\n            } else {\n              client.emit(\"warn\", \"unknown friend type \" + friend.type);\n            }\n          });\n        } else {\n          this.friends = null;\n          this.blocked_users = null;\n          this.incoming_friend_requests = null;\n          this.outgoing_friend_requests = null;\n        }\n\n        // add notes to users\n        if (data.notes) {\n          for (let note in data.notes) {\n            if (data.notes.hasOwnProperty(note)) {\n              let user = this.users.get(\"id\", note);\n              if (user) {\n                let newUser = user;\n                newUser.note = data.notes[note];\n\n                this.users.update(user, newUser);\n              } else {\n                client.emit(\"warn\", \"note in ready packet but user not cached\");\n              }\n            }\n          }\n        }\n\n        client.emit(\"debug\", `ready packet took ${Date.now() - startTime}ms to process`);\n        client.emit(\"debug\", `ready with ${this.servers.length} servers, ${this.unavailableServers.length} unavailable servers, ${this.channels.length} channels and ${this.users.length} users cached.`);\n\n        this.restartServerCreateTimeout();\n\n        break;\n      }\n      case PacketType.MESSAGE_CREATE: {\n        // format: https://discordapi.readthedocs.org/en/latest/reference/channels/messages.html#message-format\n        let channel = this.channels.get(\"id\", data.channel_id) || this.private_channels.get(\"id\", data.channel_id);\n        if (channel) {\n          let msg = channel.messages.add(new Message(data, channel, client));\n          channel.lastMessageID = msg.id;\n          if (this.messageAwaits[channel.id + msg.author.id]) {\n            this.messageAwaits[channel.id + msg.author.id].map(fn => fn(msg));\n            this.messageAwaits[channel.id + msg.author.id] = null;\n            client.emit(\"message\", msg, true); //2nd param is isAwaitedMessage\n          } else {\n            client.emit(\"message\", msg);\n          }\n        } else {\n          client.emit(\"warn\", \"message created but channel is not cached\");\n        }\n        break;\n      }\n      case PacketType.MESSAGE_DELETE: {\n        let channel = this.channels.get(\"id\", data.channel_id) || this.private_channels.get(\"id\", data.channel_id);\n        if (channel) {\n          // potentially blank\n          let msg = channel.messages.get(\"id\", data.id);\n          client.emit(\"messageDeleted\", msg, channel);\n          if (msg) {\n            channel.messages.remove(msg);\n          } else {\n            client.emit(\"debug\", \"message was deleted but message is not cached\");\n          }\n        } else {\n          client.emit(\"warn\", \"message was deleted but channel is not cached\");\n        }\n        break;\n      }\n      case PacketType.MESSAGE_DELETE_BULK: {\n        let channel = this.channels.get(\"id\", data.channel_id) || this.private_channels.get(\"id\", data.channel_id);\n        if (channel) {\n          data.ids.forEach((id) => {\n            // potentially blank\n            let msg = channel.messages.get(\"id\", id);\n            client.emit(\"messageDeleted\", msg, channel);\n            if (msg) {\n              channel.messages.remove(msg);\n            } else {\n              client.emit(\"debug\", \"message was deleted but message is not cached\");\n            }\n          });\n        } else {\n          client.emit(\"warn\", \"message was deleted but channel is not cached\");\n        }\n        break;\n      }\n      case PacketType.MESSAGE_UPDATE: {\n        // format https://discordapi.readthedocs.org/en/latest/reference/channels/messages.html#message-format\n        let channel = this.channels.get(\"id\", data.channel_id) || this.private_channels.get(\"id\", data.channel_id);\n        if (channel) {\n          // potentially blank\n          let msg = channel.messages.get(\"id\", data.id);\n\n          if (msg) {\n            // old message exists\n            data.nonce = data.nonce !== undefined ? data.nonce : msg.nonce;\n            data.attachments = data.attachments !== undefined ? data.attachments : msg.attachments;\n            data.tts = data.tts !== undefined ? data.tts : msg.tts;\n            data.embeds = data.embeds !== undefined ? data.embeds : msg.embeds;\n            data.timestamp = data.timestamp !== undefined ? data.timestamp : msg.timestamp;\n            data.mention_everyone = data.mention_everyone !== undefined ? data.mention_everyone : msg.everyoneMentioned;\n            data.content = data.content !== undefined ? data.content : msg.content;\n            data.mentions = data.mentions !== undefined ? data.mentions : msg.mentions;\n            data.author = data.author !== undefined ? data.author : msg.author;\n            msg = new Message(msg, channel, client);\n          } else if (!data.author || !data.content) {\n            break;\n          }\n          let nmsg = new Message(data, channel, client);\n          client.emit(\"messageUpdated\", msg, nmsg);\n          if (msg) {\n            channel.messages.update(msg, nmsg);\n          }\n        } else {\n          client.emit(\"warn\", \"message was updated but channel is not cached\");\n        }\n        break;\n      }\n      case PacketType.SERVER_CREATE: {\n        let server = this.servers.get(\"id\", data.id);\n        if (!server) {\n          if (!data.unavailable) {\n            server = this.servers.add(new Server(data, client));\n            if (client.options.bot === false) {\n              this.unsyncedGuilds++;\n              this.syncGuild(server.id);\n            }\n            if (client.readyTime) {\n              client.emit(\"serverCreated\", server);\n            }\n            if (this.client.options.forceFetchUsers && server.large && server.members.length < server.memberCount) {\n              this.getGuildMembers(server.id, Math.ceil(server.memberCount / 1000));\n            }\n            let unavailable = this.unavailableServers.get(\"id\", server.id);\n            if (unavailable) {\n              this.unavailableServers.remove(unavailable);\n            }\n            this.restartServerCreateTimeout();\n          } else {\n            client.emit(\"debug\", \"server was unavailable, could not create\");\n          }\n        }\n        break;\n      }\n      case PacketType.SERVER_DELETE: {\n        let server = this.servers.get(\"id\", data.id);\n        if (server) {\n          if (!data.unavailable) {\n            client.emit(\"serverDeleted\", server);\n\n            for (let channel of server.channels) {\n              this.channels.remove(channel);\n            }\n\n            this.servers.remove(server);\n\n            for (let user of server.members) {\n              let found = false;\n              for (let s of this.servers) {\n                if (s.members.get(\"id\", user.id)) {\n                  found = true;\n                  break;\n                }\n              }\n              if (!found) {\n                this.users.remove(user);\n              }\n            }\n          } else {\n            client.emit(\"debug\", \"server was unavailable, could not update\");\n          }\n          this.buckets[\"bot:msg:guild:\" + packet.d.id] =\n            this.buckets[\"dmsg:\" + packet.d.id] =\n              this.buckets[\"bdmsg:\" + packet.d.id] =\n                this.buckets[\"guild_member:\" + packet.d.id] =\n                  this.buckets[\"guild_member_nick:\" + packet.d.id] = undefined;\n        } else {\n          client.emit(\"warn\", \"server was deleted but it was not in the cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_UPDATE: {\n        let server = this.servers.get(\"id\", data.id);\n        if (server) {\n          // server exists\n          data.members = data.members || [];\n          data.channels = data.channels || [];\n          let newserver = new Server(data, client);\n          newserver.members = server.members;\n          newserver.memberMap = server.memberMap;\n          newserver.channels = server.channels;\n          if (newserver.equalsStrict(server)) {\n            // already the same don't do anything\n            client.emit(\"debug\", \"received server update but server already updated\");\n          } else {\n            client.emit(\"serverUpdated\", new Server(server, client), newserver);\n            this.servers.update(server, newserver);\n          }\n        } else if (!server) {\n          client.emit(\"warn\", \"server was updated but it was not in the cache\");\n        }\n        break;\n      }\n      case PacketType.CHANNEL_CREATE: {\n\n        let channel = this.channels.get(\"id\", data.id);\n\n        if (!channel) {\n\n          let server = this.servers.get(\"id\", data.guild_id);\n          if (server) {\n            let chan = null;\n            if (data.type === 0) {\n              chan = this.channels.add(new TextChannel(data, client, server));\n            } else {\n              chan = this.channels.add(new VoiceChannel(data, client, server));\n            }\n            client.emit(\"channelCreated\", server.channels.add(chan));\n          } else if (data.is_private) {\n            client.emit(\"channelCreated\", this.private_channels.add(new PMChannel(data, client)));\n          } else {\n            client.emit(\"warn\", \"channel created but server does not exist\");\n          }\n\n        } else {\n          client.emit(\"warn\", \"channel created but already in cache\");\n        }\n\n        break;\n      }\n      case PacketType.CHANNEL_DELETE: {\n        let channel = this.channels.get(\"id\", data.id) || this.private_channels.get(\"id\", data.id);\n        if (channel) {\n\n          if (channel.server) { // accounts for PMs\n            channel.server.channels.remove(channel);\n            this.channels.remove(channel);\n          } else {\n            this.private_channels.remove(channel);\n          }\n\n          client.emit(\"channelDeleted\", channel);\n\n        } else {\n          client.emit(\"warn\", \"channel deleted but already out of cache?\");\n        }\n        break;\n      }\n      case PacketType.CHANNEL_UPDATE: {\n        let channel = this.channels.get(\"id\", data.id) || this.private_channels.get(\"id\", data.id);\n        if (channel) {\n\n          if (channel instanceof PMChannel) {\n            //PM CHANNEL\n            client.emit(\"channelUpdated\", new PMChannel(channel, client),\n              this.private_channels.update(channel, new PMChannel(data, client)));\n          } else {\n            if (channel.server) {\n              if (channel.type === 0) {\n                //TEXT CHANNEL\n                let chan = new TextChannel(data, client, channel.server);\n                chan.messages = channel.messages;\n                client.emit(\"channelUpdated\", channel, chan);\n                channel.server.channels.update(channel, chan);\n                this.channels.update(channel, chan);\n              } else {\n                //VOICE CHANNEL\n                data.members = channel.members;\n                let chan = new VoiceChannel(data, client, channel.server);\n                client.emit(\"channelUpdated\", channel, chan);\n                channel.server.channels.update(channel, chan);\n                this.channels.update(channel, chan);\n              }\n            } else {\n              client.emit(\"warn\", \"channel updated but server non-existant\");\n            }\n          }\n\n        } else {\n          client.emit(\"warn\", \"channel updated but not in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_ROLE_CREATE: {\n        let server = this.servers.get(\"id\", data.guild_id);\n        if (server) {\n          client.emit(\"serverRoleCreated\", server.roles.add(new Role(data.role, server, client)), server);\n        } else {\n          client.emit(\"warn\", \"server role made but server not in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_ROLE_DELETE: {\n        let server = this.servers.get(\"id\", data.guild_id);\n        if (server) {\n          let role = server.roles.get(\"id\", data.role_id);\n          if (role) {\n            server.roles.remove(role);\n            client.emit(\"serverRoleDeleted\", role);\n          } else {\n            client.emit(\"warn\", \"server role deleted but role not in cache\");\n          }\n        } else {\n          client.emit(\"warn\", \"server role deleted but server not in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_ROLE_UPDATE: {\n        let server = this.servers.get(\"id\", data.guild_id);\n        if (server) {\n          let role = server.roles.get(\"id\", data.role.id);\n          if (role) {\n            let newRole = new Role(data.role, server, client);\n            client.emit(\"serverRoleUpdated\", new Role(role, server, client), newRole);\n            server.roles.update(role, newRole);\n          } else {\n            client.emit(\"warn\", \"server role updated but role not in cache\");\n          }\n        } else {\n          client.emit(\"warn\", \"server role updated but server not in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_MEMBER_ADD: {\n        let server = this.servers.get(\"id\", data.guild_id);\n        if (server) {\n\n          server.memberMap[data.user.id] = {\n            roles: data.roles,\n            mute: false,\n            selfMute: false,\n            deaf: false,\n            selfDeaf: false,\n            joinedAt: Date.parse(data.joined_at),\n            nick: data.nick || null\n          };\n\n          server.memberCount++;\n\n          client.emit(\n            \"serverNewMember\",\n            server,\n            server.members.add(this.users.add(new User(data.user, client)))\n          );\n\n        } else {\n          client.emit(\"warn\", \"server member added but server doesn't exist in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_MEMBER_REMOVE: {\n        let server = this.servers.get(\"id\", data.guild_id);\n        if (server) {\n          let user = this.users.get(\"id\", data.user.id);\n          if (user) {\n            client.emit(\"serverMemberRemoved\", server, user);\n            server.memberMap[data.user.id] = null;\n            server.members.remove(user);\n            server.memberCount--;\n          } else {\n            client.emit(\"warn\", \"server member removed but user doesn't exist in cache\");\n          }\n        } else {\n          client.emit(\"warn\", \"server member removed but server doesn't exist in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_MEMBER_UPDATE: {\n        let server = this.servers.get(\"id\", data.guild_id);\n        if (server) {\n          let user = this.users.add(new User(data.user, client));\n          if (user) {\n            let oldMember = null;\n            if (server.memberMap[data.user.id]) {\n              oldMember = {\n                roles: server.memberMap[data.user.id].roles,\n                mute: server.memberMap[data.user.id].mute,\n                selfMute: server.memberMap[data.user.id].selfMute,\n                deaf: server.memberMap[data.user.id].deaf,\n                selfDeaf: server.memberMap[data.user.id].selfDeaf,\n                nick: server.memberMap[data.user.id].nick\n              };\n            } else {\n              server.memberMap[data.user.id] = {};\n            }\n            server.memberMap[data.user.id].roles = data.roles ? data.roles : server.memberMap[data.user.id].roles;\n            server.memberMap[data.user.id].mute = data.mute || server.memberMap[data.user.id].mute;\n            server.memberMap[data.user.id].selfMute = data.self_mute === undefined ? server.memberMap[data.user.id].selfMute : data.self_mute;\n            server.memberMap[data.user.id].deaf = data.deaf || server.memberMap[data.user.id].deaf;\n            server.memberMap[data.user.id].selfDeaf = data.self_deaf === undefined ? server.memberMap[data.user.id].selfDeaf : data.self_deaf;\n            server.memberMap[data.user.id].nick = data.nick === undefined ? server.memberMap[data.user.id].nick : data.nick || null;\n            client.emit(\"serverMemberUpdated\", server, user, oldMember);\n          } else {\n            client.emit(\"warn\", \"server member removed but user doesn't exist in cache\");\n          }\n        } else {\n          client.emit(\"warn\", \"server member updated but server doesn't exist in cache\");\n        }\n        break;\n      }\n      case PacketType.PRESENCE_UPDATE: {\n\n        let user = this.users.add(new User(data.user, client));\n        let server = this.servers.get(\"id\", data.guild_id);\n\n        if (user && server) {\n\n          server.members.add(user);\n\n          data.user.username = data.user.username || user.username;\n          data.user.id = data.user.id || user.id;\n          data.user.avatar = data.user.avatar !== undefined ? data.user.avatar : user.avatar;\n          data.user.discriminator = data.user.discriminator || user.discriminator;\n          data.user.status = data.status || user.status;\n          data.user.game = data.game !== undefined ? data.game : user.game;\n          data.user.bot = data.user.bot !== undefined ? data.user.bot : user.bot;\n\n          let presenceUser = new User(data.user, client);\n\n          if (!presenceUser.equalsStrict(user)) {\n            client.emit(\"presence\", user, presenceUser);\n            this.users.update(user, presenceUser);\n          }\n\n        } else {\n          client.emit(\"warn\", \"presence update but user/server not in cache\");\n        }\n\n        break;\n      }\n      case PacketType.USER_UPDATE: {\n\n        let user = this.users.get(\"id\", data.id);\n\n        if (user) {\n\n          data.username = data.username || user.username;\n          data.id = data.id || user.id;\n          data.avatar = data.avatar || user.avatar;\n          data.discriminator = data.discriminator || user.discriminator;\n          this.email = data.email || this.email;\n\n          let presenceUser = new User(data, client);\n\n          client.emit(\"presence\", user, presenceUser);\n          this.users.update(user, presenceUser);\n\n        } else {\n          client.emit(\"warn\", \"user update but user not in cache (this should never happen)\");\n        }\n\n        break;\n      }\n      case PacketType.TYPING: {\n\n        let user = this.users.get(\"id\", data.user_id);\n        let channel = this.channels.get(\"id\", data.channel_id) || this.private_channels.get(\"id\", data.channel_id);\n\n        if (user && channel) {\n          if (user.typing.since) {\n            user.typing.since = Date.now();\n            user.typing.channel = channel;\n          } else {\n            user.typing.since = Date.now();\n            user.typing.channel = channel;\n            client.emit(\"userTypingStarted\", user, channel);\n          }\n          setTimeout(() => {\n            if (Date.now() - user.typing.since > 5500) {\n              // they haven't typed since\n              user.typing.since = null;\n              user.typing.channel = null;\n              client.emit(\"userTypingStopped\", user, channel);\n            }\n          }, 6000);\n\n        } else {\n          client.emit(\"warn\", \"user typing but user or channel not existant in cache\");\n        }\n        break;\n      }\n      case PacketType.SERVER_BAN_ADD: {\n        let user = this.users.get(\"id\", data.user.id);\n        let server = this.servers.get(\"id\", data.guild_id);\n\n        if (user && server) {\n          client.emit(\"userBanned\", user, server);\n        } else {\n          client.emit(\"warn\", \"user banned but user/server not in cache.\");\n        }\n        break;\n      }\n      case PacketType.SERVER_BAN_REMOVE: {\n        let user = this.users.get(\"id\", data.user.id);\n        let server = this.servers.get(\"id\", data.guild_id);\n\n        if (user && server) {\n          client.emit(\"userUnbanned\", user, server);\n        } else {\n          client.emit(\"warn\", \"user unbanned but user/server not in cache.\");\n        }\n        break;\n      }\n      case PacketType.USER_NOTE_UPDATE: {\n        if (this.user.bot) {\n          return;\n        }\n        let user = this.users.get(\"id\", data.id);\n        let oldNote = user.note;\n        let note = data.note || null;\n\n        // user in cache\n        if (user) {\n          let updatedUser = user;\n          updatedUser.note = note;\n\n          client.emit(\"noteUpdated\", user, oldNote);\n\n          this.users.update(user, updatedUser);\n\n        } else {\n          client.emit(\"warn\", \"note updated but user not in cache\");\n        }\n        break;\n      }\n      case PacketType.VOICE_STATE_UPDATE: {\n        let user = this.users.get(\"id\", data.user_id);\n        let server = this.servers.get(\"id\", data.guild_id);\n\n        if (user && server) {\n\n          if (data.channel_id) {\n            // in voice channel\n            let channel = this.channels.get(\"id\", data.channel_id);\n            if (channel && channel.type === 2) {\n              server.eventVoiceStateUpdate(channel, user, data);\n            } else {\n              client.emit(\"warn\", \"voice state channel not in cache\");\n            }\n          } else {\n            // not in voice channel\n            client.emit(\"voiceLeave\", server.eventVoiceLeave(user), user);\n          }\n\n        } else {\n          client.emit(\"warn\", \"voice state update but user or server not in cache\");\n        }\n\n        if (user && user.id === this.user.id) { // only for detecting self user movements for connections.\n          let connection = this.voiceConnections.get(\"server\", server);\n          // existing connection, perhaps channel moved\n          if (connection && connection.voiceChannel && connection.voiceChannel.id !== data.channel_id) {\n            // moved, update info\n            connection.voiceChannel = this.channels.get(\"id\", data.channel_id);\n            client.emit(\"voiceMoved\", connection.voiceChannel); // Moved to a new channel\n          }\n        }\n\n        break;\n      }\n      case PacketType.SERVER_MEMBERS_CHUNK: {\n\n        let server = this.servers.get(\"id\", data.guild_id);\n\n        if (server) {\n\n          let testtime = Date.now();\n\n          for (let user of data.members) {\n            server.memberMap[user.user.id] = {\n              roles: user.roles,\n              mute: user.mute,\n              selfMute: false,\n              deaf: user.deaf,\n              selfDeaf: false,\n              joinedAt: Date.parse(user.joined_at),\n              nick: user.nick || null\n            };\n            server.members.add(this.users.add(new User(user.user, client)));\n          }\n\n          if (this.forceFetchCount.hasOwnProperty(server.id)) {\n            if (this.forceFetchCount[server.id] <= 1) {\n              delete this.forceFetchCount[server.id];\n              this.restartServerCreateTimeout();\n            } else {\n              this.forceFetchCount[server.id]--;\n            }\n          }\n\n          client.emit(\"debug\", (Date.now() - testtime) + \"ms for \" + data.members.length + \" user chunk for server with id \" + server.id);\n\n        } else {\n          client.emit(\"warn\", \"chunk update received but server not in cache\");\n        }\n\n        break;\n      }\n      case PacketType.FRIEND_ADD: {\n        if (this.user.bot) {\n          return;\n        }\n        if (data.type === 1) { // accepted/got accepted a friend request\n          let inUser = this.incoming_friend_requests.get(\"id\", data.id);\n          if (inUser) {\n            // client accepted another user\n            this.incoming_friend_requests.remove(this.friends.add(new User(data.user, client)));\n            return;\n          }\n\n          let outUser = this.outgoing_friend_requests.get(\"id\", data.id);\n          if (outUser) {\n            // another user accepted the client\n            this.outgoing_friend_requests.remove(this.friends.add(new User(data.user, client)));\n            client.emit(\"friendRequestAccepted\", outUser);\n            return;\n          }\n        } else if (data.type === 2) {\n          // client received block\n          this.blocked_users.add(new User(data.user, client));\n        } else if (data.type === 3) {\n          // client received friend request\n          client.emit(\"friendRequestReceived\", this.incoming_friend_requests.add(new User(data.user, client)));\n        } else if (data.type === 4) {\n          // client sent friend request\n          this.outgoing_friend_requests.add(new User(data.user, client));\n        }\n        break;\n      }\n      case PacketType.FRIEND_REMOVE: {\n        if (this.user.bot) {\n          return;\n        }\n        let user = this.friends.get(\"id\", data.id);\n        if (user) {\n          this.friends.remove(user);\n          client.emit(\"friendRemoved\", user);\n          return;\n        }\n\n        user = this.blocked_users.get(\"id\", data.id);\n        if (user) { // they rejected friend request\n          this.blocked_users.remove(user);\n          return;\n        }\n\n        user = this.incoming_friend_requests.get(\"id\", data.id);\n        if (user) { // they rejected outgoing friend request OR client user manually deleted incoming through web client/other clients\n          let rejectedUser = this.outgoing_friend_requests.get(\"id\", user.id);\n          if (rejectedUser) {\n            // other person rejected outgoing\n            client.emit(\"friendRequestRejected\", this.outgoing_friend_requests.remove(rejectedUser));\n            return;\n          }\n\n          // incoming deleted manually\n          this.incoming_friend_requests.remove(user);\n          return;\n        }\n\n        user = this.outgoing_friend_requests.get(\"id\", data.id);\n        if (user) { // client cancelled incoming friend request OR client user manually deleted outgoing through web client/other clients\n          let incomingCancel = this.incoming_friend_requests.get(\"id\", user.id);\n          if (incomingCancel) {\n            // client cancelled incoming\n            this.incoming_friend_requests.remove(user);\n            return;\n          }\n\n          // outgoing deleted manually\n          this.outgoing_friend_requests.remove(user);\n          return;\n        }\n        break;\n      }\n      case PacketType.SERVER_SYNC: {\n        let guild = this.servers.get(data.id);\n        data.members.forEach((dataUser) => {\n          guild.memberMap[dataUser.user.id] = {\n            roles: dataUser.roles,\n            mute: dataUser.mute,\n            selfMute: dataUser.self_mute,\n            deaf: dataUser.deaf,\n            selfDeaf: dataUser.self_deaf,\n            joinedAt: Date.parse(dataUser.joined_at),\n            nick: dataUser.nick || null\n          };\n          guild.members.add(client.internal.users.add(new User(dataUser.user, client)));\n        });\n        for (let presence of data.presences) {\n          let user = client.internal.users.get(\"id\", presence.user.id);\n          if (user) {\n            user.status = presence.status;\n            user.game = presence.game;\n          }\n        }\n        if (guild.pendingVoiceStates && guild.pendingVoiceStates.length > 0) {\n          for (let voiceState of guild.pendingVoiceStates) {\n            let user = guild.members.get(\"id\", voiceState.user_id);\n            if (user) {\n              guild.memberMap[user.id] = guild.memberMap[user.id] || {};\n              guild.memberMap[user.id].mute = voiceState.mute || guild.memberMap[user.id].mute;\n              guild.memberMap[user.id].selfMute = voiceState.self_mute === undefined ? guild.memberMap[user.id].selfMute : voiceState.self_mute;\n              guild.memberMap[user.id].deaf = voiceState.deaf || guild.memberMap[user.id].deaf;\n              guild.memberMap[user.id].selfDeaf = voiceState.self_deaf === undefined ? guild.memberMap[user.id].selfDeaf : voiceState.self_deaf;\n              let channel = guild.channels.get(\"id\", voiceState.channel_id);\n              if (channel) {\n                guild.eventVoiceJoin(user, channel);\n              } else {\n                guild.client.emit(\"warn\", \"channel doesn't exist even though GUILD_SYNC expects them to\");\n              }\n            } else {\n              guild.client.emit(\"warn\", \"user doesn't exist even though GUILD_SYNC expects them to\");\n            }\n          }\n        }\n        guild.pendingVoiceStates = null;\n        this.unsyncedGuilds--;\n        this.restartServerCreateTimeout();\n        break;\n      }\n      default: {\n        client.emit(\"unknown\", packet);\n        break;\n      }\n    }\n  }\n\n  resume() {\n    let data = {\n      op: 6,\n      d: {\n        token: this.token,\n        session_id: this.sessionID,\n        seq: this.sequence\n      }\n    };\n\n    this.sendWS(data);\n  }\n\n  identify() {\n    let data = {\n      op: 2,\n      d: {\n        token: this.token,\n        v: GATEWAY_VERSION,\n        compress: this.client.options.compress,\n        large_threshold: this.client.options.largeThreshold,\n        properties: {\n          \"$os\": process.platform,\n          \"$browser\": \"discord.js\",\n          \"$device\": \"discord.js\",\n          \"$referrer\": \"\",\n          \"$referring_domain\": \"\"\n        }\n      }\n    };\n\n    if (this.client.options.shard) {\n      data.d.shard = this.client.options.shard;\n    }\n\n    this.sendWS(data);\n  }\n\n  heartbeat() {\n    console.log(`heartbeat called, value ${this.heartbeatAcked} current client state is ${this.state}`);\n    if (!this.heartbeatAcked) this.disconnected(true);\n    console.log(\"set it to false\");\n    this.heartbeatAcked = false;\n    this.sendWS({op: 1, d: Date.now()});\n  }\n}\n"]}